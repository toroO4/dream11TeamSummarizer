<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Player Override Test - cricbuzz11</title>
    <link href="https://fonts.googleapis.com/css2?family=Saira:wght@300;400;500;600;700;800;900&family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="js/utils/tailwind-config.js"></script>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen font-primary">
    <!-- Header -->
    <div id="app-header"></div>
    <script src="js/components/AppHeader.js"></script>

    <!-- Main Content -->
    <main class="w-full max-w-sm mx-auto px-4 py-6">
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h1 class="text-xl font-bold text-gray-900 mb-4">Player Override Test</h1>
            
            <div class="space-y-4">
                <!-- Test Team Selection -->
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Test Team</label>
                    <select id="test-team-select" class="w-full p-3 border-2 border-gray-200 rounded focus:ring-2 focus:ring-primary focus:border-primary transition-all duration-200 bg-white text-sm">
                        <option value="">Select a test team</option>
                        <option value="test-team-1">Test Team 1 (with OCR errors)</option>
                        <option value="test-team-2">Test Team 2 (all valid players)</option>
                    </select>
                </div>

                <!-- Test Team Data -->
                <div id="test-team-data" class="hidden">
                    <h3 class="text-sm font-semibold text-gray-700 mb-2">Team Players:</h3>
                    <div id="test-players-list" class="bg-gray-50 rounded p-3 text-sm space-y-2"></div>
                    
                    <!-- Test Override Button -->
                    <button id="test-override-btn" class="mt-3 text-xs bg-warning text-white px-3 py-1 rounded hover:bg-warning/90 transition-all duration-200">
                        üîç Test Override Modal
                    </button>
                </div>

                <!-- Instructions -->
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
                    <h4 class="font-semibold text-blue-900 mb-2">Test Instructions:</h4>
                    <ol class="text-xs text-blue-800 space-y-1">
                        <li>1. Select a test team from the dropdown</li>
                        <li>2. View the player validation results</li>
                        <li>3. Click "üîç Override" for invalid players</li>
                        <li>4. Test the override modal functionality</li>
                        <li>5. Check console for validation logs</li>
                    </ol>
                </div>

                <!-- Console Output -->
                <div class="bg-gray-900 text-green-400 p-3 rounded text-xs font-mono max-h-40 overflow-y-auto">
                    <div class="font-semibold mb-2">Console Output:</div>
                    <div id="console-output"></div>
                </div>
            </div>
        </div>
    </main>

    <!-- Toast Messages -->
    <div id="error-toast" class="fixed bottom-4 left-4 right-4 max-w-sm mx-auto bg-red-600 text-white p-3 sm:p-4 rounded shadow-lg transform translate-y-full transition-all duration-300 z-50">
        <div class="flex items-center">
            <div class="w-5 h-5 sm:w-6 sm:h-6 bg-white/20 rounded-full flex items-center justify-center mr-2 sm:mr-3">
                <svg class="w-3 h-3 sm:w-4 sm:h-4" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                </svg>
            </div>
            <span id="error-message" class="font-medium text-sm sm:text-base"></span>
        </div>
    </div>

    <div id="success-toast" class="fixed bottom-4 left-4 right-4 max-w-sm mx-auto bg-green-600 text-white p-3 sm:p-4 rounded shadow-lg transform translate-y-full transition-all duration-300 z-50">
        <div class="flex items-center">
            <div class="w-5 h-5 sm:w-6 sm:h-6 bg-white/20 rounded-full flex items-center justify-center mr-2 sm:mr-3">
                <svg class="w-3 h-3 sm:w-4 sm:h-4" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                </svg>
            </div>
            <span id="success-message" class="font-medium text-sm sm:text-base"></span>
        </div>
    </div>

    <!-- Load Scripts -->
    <script src="js/utils/constants.js"></script>
    <script src="js/components/Toast.js"></script>
    <script>
        // Test data
        const testTeams = {
            'test-team-1': {
                name: 'Test Team 1 (OCR Errors)',
                players: [
                    'Virat Kohli',      // Should be valid
                    'Rohit',            // Should auto-correct to Rohit Sharma
                    'Jasprit Bumrah',   // Should be valid
                    'KL Rahul',         // Should be valid
                    'Hardik Pandya',    // Should be valid
                    'R Ashwin',         // Should auto-correct to Ravichandran Ashwin
                    'Jadeja',           // Should auto-correct to Ravindra Jadeja
                    'Bumrah',           // Should suggest Jasprit Bumrah
                    'Invalid Player',   // Should show override options
                    'Test Player'       // Should show override options
                ]
            },
            'test-team-2': {
                name: 'Test Team 2 (All Valid)',
                players: [
                    'Virat Kohli',
                    'Rohit Sharma',
                    'Jasprit Bumrah',
                    'KL Rahul',
                    'Hardik Pandya',
                    'Ravichandran Ashwin',
                    'Ravindra Jadeja',
                    'MS Dhoni',
                    'Yuzvendra Chahal',
                    'Bhuvneshwar Kumar'
                ]
            }
        };

        // Mock match details for testing
        const mockMatchDetails = {
            teamA: 'Mumbai Indians',
            teamB: 'Chennai Super Kings',
            matchDate: '2024-04-15'
        };

        // Console output capture
        const originalLog = console.log;
        const originalError = console.error;
        const consoleOutput = document.getElementById('console-output');

        function captureConsole(type, ...args) {
            const timestamp = new Date().toLocaleTimeString();
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ');
            
            consoleOutput.innerHTML += `<div class="text-xs mb-1"><span class="text-yellow-400">[${timestamp}]</span> <span class="text-${type === 'error' ? 'red' : 'green'}-400">${message}</span></div>`;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }

        console.log = (...args) => {
            originalLog(...args);
            captureConsole('log', ...args);
        };

        console.error = (...args) => {
            originalError(...args);
            captureConsole('error', ...args);
        };

        // Test functionality
        class PlayerOverrideTest {
            constructor() {
                this.toast = new Toast();
                this.toast.initialize('error-toast', 'error-message', 'success-toast', 'success-message');
                this.setupEventListeners();
            }

            setupEventListeners() {
                document.getElementById('test-team-select').addEventListener('change', (e) => {
                    this.handleTeamSelection(e.target.value);
                });

                document.getElementById('test-override-btn').addEventListener('click', () => {
                    this.testOverrideModal();
                });
            }

            handleTeamSelection(teamKey) {
                if (!teamKey) {
                    document.getElementById('test-team-data').classList.add('hidden');
                    return;
                }

                const team = testTeams[teamKey];
                if (!team) return;

                console.log('Selected test team:', team.name);
                this.displayTestTeam(team);
                document.getElementById('test-team-data').classList.remove('hidden');
            }

            async displayTestTeam(team) {
                const playersList = document.getElementById('test-players-list');
                
                // Show loading
                playersList.innerHTML = `
                    <div class="flex items-center justify-center py-4">
                        <div class="w-4 h-4 border-2 border-primary/20 border-t-primary rounded-full animate-spin mr-2"></div>
                        <span class="text-xs text-gray-600">Validating players...</span>
                    </div>
                `;

                try {
                    // Simulate validation (in real app, this would call the API)
                    const validationResults = await this.simulateValidation(team.players);
                    
                    // Display results
                    playersList.innerHTML = '';
                    validationResults.forEach((result, index) => {
                        const playerDiv = document.createElement('div');
                        playerDiv.className = 'flex items-center justify-between p-3 rounded border transition-all duration-200';
                        
                        if (result.isValid) {
                            const isAutoReplaced = result.autoReplaced;
                            const bgColor = isAutoReplaced ? 'bg-blue-50 border-blue-200' : 'bg-green-50 border-green-200';
                            const iconColor = isAutoReplaced ? 'text-blue-600' : 'text-green-600';
                            const icon = isAutoReplaced ? 'üîÑ' : '‚úÖ';
                            const statusText = isAutoReplaced ? `${Math.round(result.confidence * 100)}% match` : 'Validated';
                            
                            playerDiv.className += ` ${bgColor}`;
                            playerDiv.innerHTML = `
                                <div class="flex items-center">
                                    <span class="${iconColor} mr-2">${icon}</span>
                                    <div>
                                        <span class="font-medium text-gray-900">${result.validatedName}</span>
                                        <div class="text-xs text-gray-500">${result.role || 'Unknown'} ‚Ä¢ ${result.team || 'Unknown'}</div>
                                        ${isAutoReplaced ? `<div class="text-xs ${iconColor} italic">Auto-corrected from "${result.inputName}"</div>` : ''}
                                    </div>
                                </div>
                                <div class="text-xs ${iconColor} font-medium">${statusText}</div>
                            `;
                        } else {
                            playerDiv.className += ' bg-red-50 border-red-200';
                            playerDiv.innerHTML = `
                                <div class="flex items-center">
                                    <span class="text-red-600 mr-2">‚ùå</span>
                                    <div>
                                        <span class="font-medium text-gray-900">${result.inputName}</span>
                                        <div class="text-xs text-red-600">Not found in database</div>
                                    </div>
                                </div>
                                <button onclick="testApp.showTestOverrideModal('${result.inputName}', ${index})" 
                                        class="text-xs text-red-600 hover:text-red-800 underline bg-white px-2 py-1 rounded border">
                                    üîç Override
                                </button>
                            `;
                        }
                        
                        playersList.appendChild(playerDiv);
                    });

                    console.log('Validation completed:', validationResults);
                    this.toast.showSuccess(`Validated ${team.players.length} players`);

                } catch (error) {
                    console.error('Validation error:', error);
                    playersList.innerHTML = `
                        <div class="text-center py-4">
                            <div class="text-red-600 text-sm mb-2">Failed to validate players</div>
                            <button onclick="testApp.displayTestTeam(${JSON.stringify(team)})" class="text-xs text-primary hover:underline">
                                Try again
                            </button>
                        </div>
                    `;
                }
            }

            async simulateValidation(players) {
                // Simulate API delay
                await new Promise(resolve => setTimeout(resolve, 1000));

                return players.map(player => {
                    // Simulate different validation scenarios
                    if (player === 'Virat Kohli' || player === 'Rohit Sharma' || player === 'Jasprit Bumrah') {
                        return {
                            inputName: player,
                            validatedName: player,
                            isValid: true,
                            role: 'Batsman',
                            team: 'MI',
                            confidence: 1.0,
                            autoReplaced: false
                        };
                    } else if (player === 'Rohit') {
                        return {
                            inputName: player,
                            validatedName: 'Rohit Sharma',
                            isValid: true,
                            role: 'Batsman',
                            team: 'MI',
                            confidence: 0.95,
                            autoReplaced: true
                        };
                    } else if (player === 'R Ashwin') {
                        return {
                            inputName: player,
                            validatedName: 'Ravichandran Ashwin',
                            isValid: true,
                            role: 'Bowler',
                            team: 'CSK',
                            confidence: 0.92,
                            autoReplaced: true
                        };
                    } else if (player === 'Jadeja') {
                        return {
                            inputName: player,
                            validatedName: 'Ravindra Jadeja',
                            isValid: true,
                            role: 'All-rounder',
                            team: 'CSK',
                            confidence: 0.88,
                            autoReplaced: true
                        };
                    } else if (player === 'Bumrah') {
                        return {
                            inputName: player,
                            validatedName: null,
                            isValid: false,
                            suggestions: [
                                {
                                    playerId: 1,
                                    playerName: 'Jasprit Bumrah',
                                    role: 'Bowler',
                                    team: 'MI',
                                    similarity: 0.85
                                },
                                {
                                    playerId: 2,
                                    playerName: 'Bhuvneshwar Kumar',
                                    role: 'Bowler',
                                    team: 'SRH',
                                    similarity: 0.45
                                }
                            ]
                        };
                    } else {
                        return {
                            inputName: player,
                            validatedName: null,
                            isValid: false,
                            suggestions: [
                                {
                                    playerId: 3,
                                    playerName: 'Virat Kohli',
                                    role: 'Batsman',
                                    team: 'RCB',
                                    similarity: 0.35
                                },
                                {
                                    playerId: 4,
                                    playerName: 'KL Rahul',
                                    role: 'Batsman',
                                    team: 'LSG',
                                    similarity: 0.25
                                }
                            ]
                        };
                    }
                });
            }

            showTestOverrideModal(playerName, playerIndex) {
                console.log('Opening override modal for:', playerName);
                
                // Create a simple test modal
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                modal.innerHTML = `
                    <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4">
                        <div class="bg-primary text-white p-4 rounded-t-lg">
                            <div class="flex items-center justify-between">
                                <h3 class="font-semibold text-lg">Test Override Modal</h3>
                                <button onclick="this.closest('.fixed').remove()" class="text-white hover:text-gray-200">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <div class="p-4">
                            <h4 class="font-semibold text-gray-800 mb-2">Input Player: ${playerName}</h4>
                            <p class="text-sm text-gray-600 mb-3">Test suggestions:</p>
                            <div class="space-y-2">
                                <label class="flex items-center p-3 border rounded-lg hover:bg-gray-50 cursor-pointer">
                                    <input type="radio" name="test-override" value="Suggestion 1" class="mr-3">
                                    <div class="flex-1">
                                        <div class="font-medium text-sm">Suggestion 1 (85%)</div>
                                        <div class="text-xs text-gray-500">Batsman ‚Ä¢ Team A</div>
                                    </div>
                                    <div class="text-xs font-medium text-green-600">85%</div>
                                </label>
                                <label class="flex items-center p-3 border rounded-lg hover:bg-gray-50 cursor-pointer">
                                    <input type="radio" name="test-override" value="Suggestion 2" class="mr-3">
                                    <div class="flex-1">
                                        <div class="font-medium text-sm">Suggestion 2 (65%)</div>
                                        <div class="text-xs text-gray-500">Bowler ‚Ä¢ Team B</div>
                                    </div>
                                    <div class="text-xs font-medium text-yellow-600">65%</div>
                                </label>
                                <label class="flex items-center p-3 border rounded-lg hover:bg-gray-50 cursor-pointer">
                                    <input type="radio" name="test-override" value="${playerName}" class="mr-3">
                                    <div class="flex-1">
                                        <div class="font-medium text-sm">${playerName}</div>
                                        <div class="text-xs text-gray-500">Keep Original</div>
                                    </div>
                                    <div class="text-xs font-medium text-gray-400">0%</div>
                                </label>
                            </div>
                        </div>
                        <div class="bg-gray-50 px-4 py-3 rounded-b-lg flex justify-end space-x-2">
                            <button onclick="this.closest('.fixed').remove()" class="px-4 py-2 text-sm text-gray-600 hover:text-gray-800">
                                Cancel
                            </button>
                            <button onclick="testApp.handleTestOverride()" class="px-4 py-2 text-sm bg-primary text-white rounded hover:bg-primary/90">
                                Test Override
                            </button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                // Close on outside click
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.remove();
                    }
                });
            }

            handleTestOverride() {
                const selected = document.querySelector('input[name="test-override"]:checked');
                if (selected) {
                    console.log('Test override selected:', selected.value);
                    this.toast.showSuccess(`Test override: ${selected.value}`);
                    document.querySelector('.fixed').remove();
                } else {
                    this.toast.showError('Please select an option');
                }
            }

            testOverrideModal() {
                this.showTestOverrideModal('Test Player', 0);
            }
        }

        // Initialize test app
        const testApp = new PlayerOverrideTest();
        console.log('Player Override Test initialized');
    </script>
</body>
</html> 